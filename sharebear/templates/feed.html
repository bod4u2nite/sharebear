{% extends 'base.html' %}
{% block content %}
{% load humanize %}

{% for message, like_status, youtube_id in feed_message_list %}

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61371063-1', 'auto');
  ga('send', 'pageview');
  ga('set', '&uid', {{USER_ID}}); // Set the user ID using signed-in user_id.

</script>
<div class='row message-header'>
	<div class='col-xs-8'>
		<div id='feed-profile'>
			<span><a href="/users/{{ message.creator }}"><img src="{{ message.creator.profile.profile_image_url }}" width="30" height="30" /></a></span> 
			<span id='feed-username'><a href="/users/{{ message.creator }}">{{ message.creator }}</a></span>
		</div>
	</div>
	<div class='col-xs-4'>
		<div id='feed-timestamp'>
			<time>{{ message.creation_time|date:_("DATETIME_FORMAT") }}</time> 
		</div>
	</div>
</div>
<div class='row'>
	<div class='col-xs-12'>
		 <div>
	    	<a href="/message/{{ message.id }}">View</a>
	    </div>
    </div>
</div>
    	
<div class='row'>
	<div class='col-xs-12'>
		<div id='feed-body'>
			{{ message.body|urlize }}
		</div>
	</div>
</div>
	
<div class='row'>
	<div class='col-xs-12'>
		{% if youtube_id %}
	    	 <iframe id="ytplayer" class="center-block" type="text/html" width="640" height="390" src="http://www.youtube.com/embed/{{ youtube_id }}" frameborder="0"/></iframe>
	    {% endif %}
    </div>
</div>

<div class='row engagement-buttons'>
	<div class='col-xs-3 col-xs-offset-9'>

        <div class="col-xs-4">
            <button class="btn facebook-button" onclick="facebookShare()"></button>
        </div>

        <div class="col-xs-4">
            <a class="btn twitter-button" href="https://twitter.com/intent/tweet?text=Check out this hot new track {{ message.creator }} posted on Sharebear! http://localhost:8000/message/{{ message.id }}"></a>
        </div>

	{% if like_form and user != message.creator %}
		<div class='col-xs-4'>
			{% if like_status %}

			<form action="{% url 'message_like' message.id %}" method="post">{% csrf_token %}
			<button type="submit" class="btn like-button"><span class="glyphicon glyphicon-heart" aria-hidden="true"></button>
			</form>

			{% else %}

			<form action="{% url 'message_like' message.id %}" method="post">{% csrf_token %}
			<button type="submit" class="btn btn-default like-button"><span class="glyphicon glyphicon-heart" aria-hidden="true"></button>
			</form>

			{% endif %}
		</div>

	{% endif %}

	</div>
</div>
<script>
	function facebookShare(){
		FB.ui({
		  method: 'share',
	  		href: 'http://soundcloud.com/deezium',
			}, function(response){
		    if (response && !response.error_code) {
		      alert('Posting completed.');
		    } else {
		      alert('Error while posting.');
		    }
		});
	}

	window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));


		
</script>
{% endfor %}

{% endblock %}
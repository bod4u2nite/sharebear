{% extends 'base.html' %}
{% load bootstrap3 %}
{% load humanize %}

{% block content %}

<div class='row'>
	<div id = 'top-container' class='col-md-8 col-md-offset-2'>
		<div class='row'>
				<div id='profile-pic' style='padding-top: 20px'>
				<img src="{{ profile_user.profile.profile_image_url }}" height="100" width="100"/>
				</div>
				<h2> {{ profile_user.first_name }} {{ profile_user.last_name }}</h2>
		</div>
		<div class='row'>
			<p>{{ profile_user.profile.location }}</p>
		</div>
		<div class='row'>
			<p>{{ profile_user.profile.aboutme }}</p>
		</div>

		<div class='row'>
			<h2>Shares</h2>
		</div>

		{% for message in profile_user.sent_messages.all %}
			<div class="row sender-info">
		        <div class="col-md-8">
		            <a href="/users/{{ message.creator }}"><img src="{{ message.creator.profile.profile_image_url }}" width="50" height="50" /></a>
		            <a href="/users/{{ message.creator }}">{{ message.creator }}</a>
		        </div>
		        <div class="col-md-4">
		            <p><em>Sent at {{ message.creation_time|date:_("DATETIME_FORMAT")}}</em></p>
		        </div>
		    </div>

		    <div class='row'>
		    	<div class='col-md-12'>
		    		<a href="/message/{{ message.id }}">View</a>
		    	</div>
		    </div>

		    <div class='row message-body'>
		        <div class='col-md-12'>
		            <p>{{ message.body|urlize }}</p>
		        </div>
		    </div>


		
	    {% endfor %}

		<div class='row'>
			<h2>Liked messages</h2>
		</div>

		{% for story in profile_user.feed_stories.all %}
		{% if story.is_liked %}
		
	    <div class="row sender-info">
	        <div class="col-md-8">
	            <a href="/users/{{ story.msg.creator }}"><img src="{{ story.msg.creator.profile.profile_image_url }}" width="50" height="50" /></a>
	            <a href="/users/{{ story.msg.creator }}">{{ story.msg.creator }}</a>
	        </div>
	        <div class="col-md-4">
	            <p><em>Sent at {{ story.msg.creation_time|date:_("DATETIME_FORMAT")}}</em></p>
	        </div>
	    </div>

        <div class='row'>
	    	<div class='col-md-12'>
	    		<a href="/message/{{ story.msg.id }}">View</a>
	    	</div>
	    </div>

	    <div class='row message-body'>
	        <div class='col-md-12'>
	            <p>{{ story.msg.body|urlize }}</p>
	        </div>
	    </div>
	    {% endif %}
	    {% endfor %}

	    {% if profile_user != user %}
	    	{% if following %}

		    <div class='row'>
		        <div class='col-md-12'>
		            <form action="{% url 'user_follow' profile_user.profile.id %}" method="post">{% csrf_token %}
		                <button type="submit" class="btn">Unfollow</button>
		            </form>
		        </div>
		    </div>

		    {% else %}

		    <div class='row'>
		        <div class='col-md-12'>
		            <form action="{% url 'user_follow' profile_user.profile.id %}" method="post">{% csrf_token %}
		                <button type="submit" class="btn btn-default">Follow</button>
		            </form>
		        </div>
		    </div>

		    {% endif %}

	    {% endif %}

		{% if profile_user == user %}
			<div class='row'>
				<div id='profile-edit'>
					<h3> Edit Profile </h3>
				</div>
					<form enctype='multipart/form-data' action='/edit/' method='post'>{% csrf_token %}
						{% bootstrap_form edit_form %}
						<input type='hidden' value='{{ next_url }}' name='next_url'>
						<input type='submit' class='btn btn-default' value='Update!'>
					</form>
			</div>
		{% endif %}

	</div>
</div>


{% endblock %}
